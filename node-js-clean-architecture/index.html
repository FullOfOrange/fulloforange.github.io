<!DOCTYPE html><html lang="kr"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.12.9"/><meta name="description" content="이 글은 만들면서 배우는 클린 아키텍처 라는 책을 읽고 작성한 글이에요. 이 책에서는 전통적인 자바 + 스프링을 기반으로 아키텍처를 설명해나가요. Spring + Java는 잘 발달한 DI 컨테이너를 제공해주며 클래스와 인터페이스 기반의 코드를 쉽게…" data-gatsby-head="true"/><meta name="image" content="https://fulloforange.github.io/banner.jpg" data-gatsby-head="true"/><meta property="og:title" content="Node.js Clean Architecture | 육진혁 블로그" data-gatsby-head="true"/><meta property="og:url" content="https://fulloforange.github.io/node-js-clean-architecture" data-gatsby-head="true"/><meta property="og:description" content="이 글은 만들면서 배우는 클린 아키텍처 라는 책을 읽고 작성한 글이에요. 이 책에서는 전통적인 자바 + 스프링을 기반으로 아키텍처를 설명해나가요. Spring + Java는 잘 발달한 DI 컨테이너를 제공해주며 클래스와 인터페이스 기반의 코드를 쉽게…" data-gatsby-head="true"/><meta property="og:image" content="https://fulloforange.github.io/banner.jpg" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:image:alt" content="이 글은 만들면서 배우는 클린 아키텍처 라는 책을 읽고 작성한 글이에요. 이 책에서는 전통적인 자바 + 스프링을 기반으로 아키텍처를 설명해나가요. Spring + Java는 잘 발달한 DI 컨테이너를 제공해주며 클래스와 인터페이스 기반의 코드를 쉽게…" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="Node.js Clean Architecture | 육진혁 블로그" data-gatsby-head="true"/><meta name="twitter:url" content="https://fulloforange.github.io/node-js-clean-architecture" data-gatsby-head="true"/><meta name="twitter:description" content="이 글은 만들면서 배우는 클린 아키텍처 라는 책을 읽고 작성한 글이에요. 이 책에서는 전통적인 자바 + 스프링을 기반으로 아키텍처를 설명해나가요. Spring + Java는 잘 발달한 DI 컨테이너를 제공해주며 클래스와 인터페이스 기반의 코드를 쉽게…" data-gatsby-head="true"/><meta name="twitter:image" content="https://fulloforange.github.io/banner.jpg" data-gatsby-head="true"/><meta name="twitter:image:alt" content="이 글은 만들면서 배우는 클린 아키텍처 라는 책을 읽고 작성한 글이에요. 이 책에서는 전통적인 자바 + 스프링을 기반으로 아키텍처를 설명해나가요. Spring + Java는 잘 발달한 DI 컨테이너를 제공해주며 클래스와 인터페이스 기반의 코드를 쉽게…" data-gatsby-head="true"/><meta name="twitter:creator" content="@fulloforange" data-gatsby-head="true"/><meta name="gatsby-theme" content="@lekoarts/gatsby-theme-minimal-blog" data-gatsby-head="true"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png"/><link rel="apple-touch-icon" sizes="512x512" href="/android-chrome-512x512.png"/><link rel="alternate" type="application/rss+xml" title="육진혁 블로그" href="/rss.xml"/><style data-emotion="css-global 6koz1s" data-gatsby-head="true">html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#2d3748;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#6b46c1;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#5f6c80;--theme-ui-colors-muted:#edf2f7;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#2d3748;--theme-ui-colors-heading:#000;--theme-ui-colors-divide:#cbd5e0;--theme-ui-colors-highlightLineBg:rgba(0, 0, 0, 0.035);--theme-ui-colors-plain-color:#393A34;--theme-ui-colors-plain-backgroundColor:#f6f8fa;--theme-ui-colors-comment-color:#999988;--theme-ui-colors-comment-fontStyle:italic;--theme-ui-colors-prolog-color:#999988;--theme-ui-colors-prolog-fontStyle:italic;--theme-ui-colors-doctype-color:#999988;--theme-ui-colors-doctype-fontStyle:italic;--theme-ui-colors-cdata-color:#999988;--theme-ui-colors-cdata-fontStyle:italic;--theme-ui-colors-namespace-opacity:0.7;--theme-ui-colors-string-color:#e3116c;--theme-ui-colors-attr-value-color:#e3116c;--theme-ui-colors-punctuation-color:#393A34;--theme-ui-colors-operator-color:#393A34;--theme-ui-colors-entity-color:#36acaa;--theme-ui-colors-url-color:#36acaa;--theme-ui-colors-symbol-color:#36acaa;--theme-ui-colors-number-color:#36acaa;--theme-ui-colors-boolean-color:#36acaa;--theme-ui-colors-variable-color:#36acaa;--theme-ui-colors-constant-color:#36acaa;--theme-ui-colors-property-color:#36acaa;--theme-ui-colors-regex-color:#36acaa;--theme-ui-colors-inserted-color:#36acaa;--theme-ui-colors-atrule-color:#00a4db;--theme-ui-colors-keyword-color:#00009f;--theme-ui-colors-attr-name-color:#00a4db;--theme-ui-colors-selector-color:#00009f;--theme-ui-colors-function-color:#d73a49;--theme-ui-colors-deleted-color:#d73a49;--theme-ui-colors-tag-color:#00009f;--theme-ui-colors-function-variable-color:#6f42c1;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}html.theme-ui-light,.theme-ui-light html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#2d3748;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#6b46c1;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#5f6c80;--theme-ui-colors-muted:#edf2f7;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#2d3748;--theme-ui-colors-heading:#000;--theme-ui-colors-divide:#cbd5e0;--theme-ui-colors-highlightLineBg:rgba(0, 0, 0, 0.035);--theme-ui-colors-plain-color:#393A34;--theme-ui-colors-plain-backgroundColor:#f6f8fa;--theme-ui-colors-comment-color:#999988;--theme-ui-colors-comment-fontStyle:italic;--theme-ui-colors-prolog-color:#999988;--theme-ui-colors-prolog-fontStyle:italic;--theme-ui-colors-doctype-color:#999988;--theme-ui-colors-doctype-fontStyle:italic;--theme-ui-colors-cdata-color:#999988;--theme-ui-colors-cdata-fontStyle:italic;--theme-ui-colors-namespace-opacity:0.7;--theme-ui-colors-string-color:#e3116c;--theme-ui-colors-attr-value-color:#e3116c;--theme-ui-colors-punctuation-color:#393A34;--theme-ui-colors-operator-color:#393A34;--theme-ui-colors-entity-color:#36acaa;--theme-ui-colors-url-color:#36acaa;--theme-ui-colors-symbol-color:#36acaa;--theme-ui-colors-number-color:#36acaa;--theme-ui-colors-boolean-color:#36acaa;--theme-ui-colors-variable-color:#36acaa;--theme-ui-colors-constant-color:#36acaa;--theme-ui-colors-property-color:#36acaa;--theme-ui-colors-regex-color:#36acaa;--theme-ui-colors-inserted-color:#36acaa;--theme-ui-colors-atrule-color:#00a4db;--theme-ui-colors-keyword-color:#00009f;--theme-ui-colors-attr-name-color:#00a4db;--theme-ui-colors-selector-color:#00009f;--theme-ui-colors-function-color:#d73a49;--theme-ui-colors-deleted-color:#d73a49;--theme-ui-colors-tag-color:#00009f;--theme-ui-colors-function-variable-color:#6f42c1;}html.theme-ui-dark,.theme-ui-dark html{--theme-ui-colors-text:#cbd5e0;--theme-ui-colors-primary:#b794f4;--theme-ui-colors-secondary:#8a9ab0;--theme-ui-colors-toggleIcon:#cbd5e0;--theme-ui-colors-background:#1A202C;--theme-ui-colors-heading:#fff;--theme-ui-colors-divide:#2d3748;--theme-ui-colors-muted:#2d3748;--theme-ui-colors-highlightLineBg:rgba(255, 255, 255, 0.1);--theme-ui-colors-plain-color:#9CDCFE;--theme-ui-colors-plain-backgroundColor:#1E1E1E;--theme-ui-colors-prolog-color:rgb(0, 0, 128);--theme-ui-colors-comment-color:rgb(106, 153, 85);--theme-ui-colors-builtin-color:rgb(86, 156, 214);--theme-ui-colors-changed-color:rgb(86, 156, 214);--theme-ui-colors-keyword-color:rgb(86, 156, 214);--theme-ui-colors-interpolation-punctuation-color:rgb(86, 156, 214);--theme-ui-colors-number-color:rgb(181, 206, 168);--theme-ui-colors-inserted-color:rgb(181, 206, 168);--theme-ui-colors-constant-color:rgb(100, 102, 149);--theme-ui-colors-attr-name-color:rgb(156, 220, 254);--theme-ui-colors-variable-color:rgb(156, 220, 254);--theme-ui-colors-deleted-color:rgb(206, 145, 120);--theme-ui-colors-string-color:rgb(206, 145, 120);--theme-ui-colors-attr-value-color:rgb(206, 145, 120);--theme-ui-colors-template-punctuation-color:rgb(206, 145, 120);--theme-ui-colors-selector-color:rgb(215, 186, 125);--theme-ui-colors-tag-color:rgb(86, 156, 214);--theme-ui-colors-punctuation-color:#808080;--theme-ui-colors-operator-color:rgb(212, 212, 212);--theme-ui-colors-function-color:rgb(220, 220, 170);--theme-ui-colors-class-name-color:rgb(78, 201, 176);--theme-ui-colors-char-color:rgb(209, 105, 105);}</style><style data-emotion="css-global 1mawjxo" data-gatsby-head="true">*{box-sizing:border-box;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);margin:0;padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;}html img{border-style:none;}html pre{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;}html a{-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;color:var(--theme-ui-colors-text);}body{margin:0;}</style><title data-gatsby-head="true">Node.js Clean Architecture | 육진혁 블로그</title><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" data-gatsby-head="true"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" data-gatsby-head="true"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" data-gatsby-head="true"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.documentElement.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion="css-global 6koz1s">html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#2d3748;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#6b46c1;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#5f6c80;--theme-ui-colors-muted:#edf2f7;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#2d3748;--theme-ui-colors-heading:#000;--theme-ui-colors-divide:#cbd5e0;--theme-ui-colors-highlightLineBg:rgba(0, 0, 0, 0.035);--theme-ui-colors-plain-color:#393A34;--theme-ui-colors-plain-backgroundColor:#f6f8fa;--theme-ui-colors-comment-color:#999988;--theme-ui-colors-comment-fontStyle:italic;--theme-ui-colors-prolog-color:#999988;--theme-ui-colors-prolog-fontStyle:italic;--theme-ui-colors-doctype-color:#999988;--theme-ui-colors-doctype-fontStyle:italic;--theme-ui-colors-cdata-color:#999988;--theme-ui-colors-cdata-fontStyle:italic;--theme-ui-colors-namespace-opacity:0.7;--theme-ui-colors-string-color:#e3116c;--theme-ui-colors-attr-value-color:#e3116c;--theme-ui-colors-punctuation-color:#393A34;--theme-ui-colors-operator-color:#393A34;--theme-ui-colors-entity-color:#36acaa;--theme-ui-colors-url-color:#36acaa;--theme-ui-colors-symbol-color:#36acaa;--theme-ui-colors-number-color:#36acaa;--theme-ui-colors-boolean-color:#36acaa;--theme-ui-colors-variable-color:#36acaa;--theme-ui-colors-constant-color:#36acaa;--theme-ui-colors-property-color:#36acaa;--theme-ui-colors-regex-color:#36acaa;--theme-ui-colors-inserted-color:#36acaa;--theme-ui-colors-atrule-color:#00a4db;--theme-ui-colors-keyword-color:#00009f;--theme-ui-colors-attr-name-color:#00a4db;--theme-ui-colors-selector-color:#00009f;--theme-ui-colors-function-color:#d73a49;--theme-ui-colors-deleted-color:#d73a49;--theme-ui-colors-tag-color:#00009f;--theme-ui-colors-function-variable-color:#6f42c1;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}html.theme-ui-light,.theme-ui-light html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#2d3748;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#6b46c1;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#5f6c80;--theme-ui-colors-muted:#edf2f7;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#2d3748;--theme-ui-colors-heading:#000;--theme-ui-colors-divide:#cbd5e0;--theme-ui-colors-highlightLineBg:rgba(0, 0, 0, 0.035);--theme-ui-colors-plain-color:#393A34;--theme-ui-colors-plain-backgroundColor:#f6f8fa;--theme-ui-colors-comment-color:#999988;--theme-ui-colors-comment-fontStyle:italic;--theme-ui-colors-prolog-color:#999988;--theme-ui-colors-prolog-fontStyle:italic;--theme-ui-colors-doctype-color:#999988;--theme-ui-colors-doctype-fontStyle:italic;--theme-ui-colors-cdata-color:#999988;--theme-ui-colors-cdata-fontStyle:italic;--theme-ui-colors-namespace-opacity:0.7;--theme-ui-colors-string-color:#e3116c;--theme-ui-colors-attr-value-color:#e3116c;--theme-ui-colors-punctuation-color:#393A34;--theme-ui-colors-operator-color:#393A34;--theme-ui-colors-entity-color:#36acaa;--theme-ui-colors-url-color:#36acaa;--theme-ui-colors-symbol-color:#36acaa;--theme-ui-colors-number-color:#36acaa;--theme-ui-colors-boolean-color:#36acaa;--theme-ui-colors-variable-color:#36acaa;--theme-ui-colors-constant-color:#36acaa;--theme-ui-colors-property-color:#36acaa;--theme-ui-colors-regex-color:#36acaa;--theme-ui-colors-inserted-color:#36acaa;--theme-ui-colors-atrule-color:#00a4db;--theme-ui-colors-keyword-color:#00009f;--theme-ui-colors-attr-name-color:#00a4db;--theme-ui-colors-selector-color:#00009f;--theme-ui-colors-function-color:#d73a49;--theme-ui-colors-deleted-color:#d73a49;--theme-ui-colors-tag-color:#00009f;--theme-ui-colors-function-variable-color:#6f42c1;}html.theme-ui-dark,.theme-ui-dark html{--theme-ui-colors-text:#cbd5e0;--theme-ui-colors-primary:#b794f4;--theme-ui-colors-secondary:#8a9ab0;--theme-ui-colors-toggleIcon:#cbd5e0;--theme-ui-colors-background:#1A202C;--theme-ui-colors-heading:#fff;--theme-ui-colors-divide:#2d3748;--theme-ui-colors-muted:#2d3748;--theme-ui-colors-highlightLineBg:rgba(255, 255, 255, 0.1);--theme-ui-colors-plain-color:#9CDCFE;--theme-ui-colors-plain-backgroundColor:#1E1E1E;--theme-ui-colors-prolog-color:rgb(0, 0, 128);--theme-ui-colors-comment-color:rgb(106, 153, 85);--theme-ui-colors-builtin-color:rgb(86, 156, 214);--theme-ui-colors-changed-color:rgb(86, 156, 214);--theme-ui-colors-keyword-color:rgb(86, 156, 214);--theme-ui-colors-interpolation-punctuation-color:rgb(86, 156, 214);--theme-ui-colors-number-color:rgb(181, 206, 168);--theme-ui-colors-inserted-color:rgb(181, 206, 168);--theme-ui-colors-constant-color:rgb(100, 102, 149);--theme-ui-colors-attr-name-color:rgb(156, 220, 254);--theme-ui-colors-variable-color:rgb(156, 220, 254);--theme-ui-colors-deleted-color:rgb(206, 145, 120);--theme-ui-colors-string-color:rgb(206, 145, 120);--theme-ui-colors-attr-value-color:rgb(206, 145, 120);--theme-ui-colors-template-punctuation-color:rgb(206, 145, 120);--theme-ui-colors-selector-color:rgb(215, 186, 125);--theme-ui-colors-tag-color:rgb(86, 156, 214);--theme-ui-colors-punctuation-color:#808080;--theme-ui-colors-operator-color:rgb(212, 212, 212);--theme-ui-colors-function-color:rgb(220, 220, 170);--theme-ui-colors-class-name-color:rgb(78, 201, 176);--theme-ui-colors-char-color:rgb(209, 105, 105);}</style><style data-emotion="css-global 1mawjxo">*{box-sizing:border-box;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);margin:0;padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;}html img{border-style:none;}html pre{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;}html a{-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;color:var(--theme-ui-colors-text);}body{margin:0;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css-global cjr7z1">*{box-sizing:inherit;}[hidden]{display:none;}::selection{background-color:var(--theme-ui-colors-text);color:var(--theme-ui-colors-background);}</style><style data-emotion="css 1gq7j3t">.css-1gq7j3t{border:0;clip:react(0 0 0 0);height:1px;width:1px;margin:-1px;padding:0;overflow:hidden;position:absolute;}.css-1gq7j3t:focus{padding:1rem;position:fixed;top:15px;left:15px;background-color:var(--theme-ui-colors-heading);color:var(--theme-ui-colors-background);z-index:1;width:auto;height:auto;clip:auto;-webkit-text-decoration:none;text-decoration:none;}</style><a href="#skip-nav" data-skip-link="true" class="css-1gq7j3t">Skip to content</a><style data-emotion="css 10f80pj">.css-10f80pj{box-sizing:border-box;margin:0;min-width:0;width:100%;max-width:container;margin-left:auto;margin-right:auto;padding:1rem;max-width:1024px;}@media screen and (min-width: 640px){.css-10f80pj{padding:2rem;}}</style><div class="css-10f80pj"><style data-emotion="css egutgn">.css-egutgn{margin-bottom:4rem;}@media screen and (min-width: 640px){.css-egutgn{margin-bottom:8rem;}}</style><header class="css-egutgn"><style data-emotion="css 1xwyizx">.css-1xwyizx{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}</style><style data-emotion="css 1pbimyf">.css-1pbimyf{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}</style><div class="css-1pbimyf"><style data-emotion="css uxjqfw">.css-uxjqfw{color:var(--theme-ui-colors-heading);-webkit-text-decoration:none;text-decoration:none;}</style><a aria-label="육진혁 블로그 - Back to home" class="css-uxjqfw" href="/"><style data-emotion="css 19i8ga6">.css-19i8ga6{margin-top:0;margin-bottom:0;font-weight:600;font-size:1.5rem;}@media screen and (min-width: 640px){.css-19i8ga6{font-size:1.875rem;}}</style><div class="css-19i8ga6">육진혁 블로그</div></a><style data-emotion="css 3ba0x7">.css-3ba0x7{opacity:0.65;position:relative;border-radius:4px;width:40px;height:25px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;border:none;outline:none;background:none;cursor:pointer;padding:0;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;}.css-3ba0x7:hover,.css-3ba0x7:focus{opacity:1;}</style><button type="button" class="css-3ba0x7"><style data-emotion="css 1ggalm8">.css-1ggalm8{position:relative;width:24px;height:24px;border-radius:50%;-webkit-transition:all 0.45s ease;transition:all 0.45s ease;-webkit-transform:scale(0.55);-moz-transform:scale(0.55);-ms-transform:scale(0.55);transform:scale(0.55);}.css-1ggalm8:before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;-webkit-transition:-webkit-transform 0.45s ease;transition:transform 0.45s ease;border-radius:50%;opacity:0;}.css-1ggalm8:after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;left:50%;-webkit-transition:all 0.35s ease;transition:all 0.35s ease;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon),0 23px 0 var(--theme-ui-colors-toggleIcon),23px 0 0 var(--theme-ui-colors-toggleIcon),-23px 0 0 var(--theme-ui-colors-toggleIcon),15px 15px 0 var(--theme-ui-colors-toggleIcon),-15px 15px 0 var(--theme-ui-colors-toggleIcon),15px -15px 0 var(--theme-ui-colors-toggleIcon),-15px -15px 0 var(--theme-ui-colors-toggleIcon);-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}</style><div class="css-1ggalm8"></div></button></div><style data-emotion="css fp1v3n">.css-fp1v3n{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:var(--theme-ui-colors-divide);padding-bottom:1rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-top:1rem;color:var(--theme-ui-colors-secondary);-webkit-box-flex-flow:wrap;-webkit-flex-flow:wrap;-ms-flex-flow:wrap;flex-flow:wrap;}.css-fp1v3n a{color:var(--theme-ui-colors-secondary);}.css-fp1v3n a:hover{color:var(--theme-ui-colors-heading);}</style><div class="css-fp1v3n"><style data-emotion="css 1lx5s1f">.css-1lx5s1f{font-size:1rem;}.css-1lx5s1f a:not(:last-of-type){margin-right:1rem;}@media screen and (min-width: 640px){.css-1lx5s1f{font-size:18px;}}.css-1lx5s1f .active{color:var(--theme-ui-colors-heading);}</style><nav class="css-1lx5s1f"><style data-emotion="css bpdkdn">.css-bpdkdn{color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-bpdkdn:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="css-bpdkdn" href="/about/">소개</a><a class="css-bpdkdn" href="/blog/">게시글</a></nav><style data-emotion="css 45ghvz">.css-45ghvz{font-size:1rem;}.css-45ghvz a:not(:first-of-type){margin-left:1rem;}@media screen and (min-width: 640px){.css-45ghvz{font-size:18px;}}</style><div class="css-45ghvz"><style data-emotion="css aizfxq">.css-aizfxq{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-aizfxq:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="https://github.com/fullOfOrange" class="css-aizfxq">Github</a><a href="mailto:fulloforange@gmail.com" class="css-aizfxq">Email</a></div></div></header><style data-emotion="css 1w9aswf">.css-1w9aswf .prism-code{font-size:1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width: 640px){.css-1w9aswf .prism-code{font-size:1rem;}}@media screen and (min-width: 768px){.css-1w9aswf .prism-code{font-size:1.25rem;}}.css-1w9aswf .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-1w9aswf .gatsby-highlight[data-language='none'] .code-content,.css-1w9aswf .gatsby-highlight[data-language=''] .code-content{padding-top:1rem;}.css-1w9aswf .code-content{padding:2rem 1rem 1rem 1rem;color:var(--theme-ui-colors-plain-color);background-color:var(--theme-ui-colors-plain-backgroundColor);}.css-1w9aswf .token{display:inline-block;}.css-1w9aswf p>code,.css-1w9aswf li>code{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-heading);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:4px;font-size:0.95em;}.css-1w9aswf .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;border-radius:4px;overflow:hidden;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-1w9aswf .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-1w9aswf .gatsby-highlight{font-size:1.25rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-1w9aswf .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-1w9aswf .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-1w9aswf .gatsby-highlight pre code{float:left;min-width:100%;}.css-1w9aswf .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white);border-radius:0 0 4px 4px;color:var(--theme-ui-colors-black);font-size:12px;letter-spacing:0.035rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;}.css-1w9aswf .gatsby-highlight pre[class~="language-golang"]:before,.css-1w9aswf .gatsby-highlight pre[class~="language-go"]:before{content:"go";background:#79d4fd;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-javascript"]:before,.css-1w9aswf .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-1w9aswf .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-php"]:before{content:"php";background:#777bb3;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-py"]:before,.css-1w9aswf .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-1w9aswf .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-1w9aswf .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-1w9aswf .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-1w9aswf .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-1w9aswf .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-1w9aswf .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-1w9aswf .gatsby-highlight pre[class~='language-json']:before,.css-1w9aswf .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-1w9aswf .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-1w9aswf .gatsby-highlight>code[class*="language-"],.css-1w9aswf .gatsby-highlight>pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1w9aswf .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-1w9aswf .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary);}.css-1w9aswf .gatsby-highlight pre::-webkit-scrollbar-track{background:var(--theme-ui-colors-muted);}.css-1w9aswf .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-1w9aswf .code-title{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-text);font-size:1rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";}.css-1w9aswf .token-line{padding-right:1rem;}.css-1w9aswf .highlight-line{border-left:4px solid rgb(2, 155, 206);}.css-1w9aswf .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-1w9aswf .footnotes{border-top-style:solid;border-top-width:1px;border-top-color:var(--theme-ui-colors-divide);padding-top:0.5rem;margin-top:4rem;overflow:auto;}.css-1w9aswf .footnotes .sr-only{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><style data-emotion="css 1wlcpc3">.css-1wlcpc3{box-sizing:border-box;margin:0;min-width:0;}.css-1wlcpc3 .prism-code{font-size:1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width: 640px){.css-1wlcpc3 .prism-code{font-size:1rem;}}@media screen and (min-width: 768px){.css-1wlcpc3 .prism-code{font-size:1.25rem;}}.css-1wlcpc3 .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-1wlcpc3 .gatsby-highlight[data-language='none'] .code-content,.css-1wlcpc3 .gatsby-highlight[data-language=''] .code-content{padding-top:1rem;}.css-1wlcpc3 .code-content{padding:2rem 1rem 1rem 1rem;color:var(--theme-ui-colors-plain-color);background-color:var(--theme-ui-colors-plain-backgroundColor);}.css-1wlcpc3 .token{display:inline-block;}.css-1wlcpc3 p>code,.css-1wlcpc3 li>code{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-heading);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:4px;font-size:0.95em;}.css-1wlcpc3 .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;border-radius:4px;overflow:hidden;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-1wlcpc3 .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-1wlcpc3 .gatsby-highlight{font-size:1.25rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-1wlcpc3 .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-1wlcpc3 .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-1wlcpc3 .gatsby-highlight pre code{float:left;min-width:100%;}.css-1wlcpc3 .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white);border-radius:0 0 4px 4px;color:var(--theme-ui-colors-black);font-size:12px;letter-spacing:0.035rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;}.css-1wlcpc3 .gatsby-highlight pre[class~="language-golang"]:before,.css-1wlcpc3 .gatsby-highlight pre[class~="language-go"]:before{content:"go";background:#79d4fd;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-javascript"]:before,.css-1wlcpc3 .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-1wlcpc3 .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-php"]:before{content:"php";background:#777bb3;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-py"]:before,.css-1wlcpc3 .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-1wlcpc3 .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-1wlcpc3 .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-1wlcpc3 .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-json']:before,.css-1wlcpc3 .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-1wlcpc3 .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-1wlcpc3 .gatsby-highlight>code[class*="language-"],.css-1wlcpc3 .gatsby-highlight>pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1wlcpc3 .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-1wlcpc3 .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary);}.css-1wlcpc3 .gatsby-highlight pre::-webkit-scrollbar-track{background:var(--theme-ui-colors-muted);}.css-1wlcpc3 .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-1wlcpc3 .code-title{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-text);font-size:1rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";}.css-1wlcpc3 .token-line{padding-right:1rem;}.css-1wlcpc3 .highlight-line{border-left:4px solid rgb(2, 155, 206);}.css-1wlcpc3 .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-1wlcpc3 .footnotes{border-top-style:solid;border-top-width:1px;border-top-color:var(--theme-ui-colors-divide);padding-top:0.5rem;margin-top:4rem;overflow:auto;}.css-1wlcpc3 .footnotes .sr-only{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><main id="skip-nav" class=" css-1wlcpc3"><style data-emotion="css w1q1hj">.css-w1q1hj{box-sizing:border-box;margin:0;min-width:0;font-family:inherit;font-weight:700;line-height:1.25;font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.875rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-w1q1hj{font-size:2.25rem;}}@media screen and (min-width: 768px){.css-w1q1hj{font-size:2.25rem;}}@media screen and (min-width: 1024px){.css-w1q1hj{font-size:3rem;}}</style><h1 class="css-w1q1hj">Node.js Clean Architecture</h1><style data-emotion="css 15ce8we">.css-15ce8we{color:var(--theme-ui-colors-secondary);margin-top:1rem;font-size:1rem;}.css-15ce8we a{color:var(--theme-ui-colors-secondary);}@media screen and (min-width: 640px){.css-15ce8we{font-size:1rem;}}@media screen and (min-width: 768px){.css-15ce8we{font-size:1.25rem;}}</style><p class="css-15ce8we"><time>09.11.2023</time> — <span>21<!-- --> min read</span></p><style data-emotion="css 1mae7sn">.css-1mae7sn{margin-top:4rem;margin-bottom:4rem;}.css-1mae7sn .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;border-radius:4px;box-shadow:rgba(0, 0, 0, 0.1) 0px 16px 16px 0px,rgba(0, 0, 0, 0.1) 0px 8px 8px 0px,rgba(0, 0, 0, 0.1) 0px 4px 4px 0px;}@media screen and (min-width: 640px){.css-1mae7sn .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;}}@media screen and (min-width: 768px){.css-1mae7sn .gatsby-resp-image-wrapper{margin-top:4rem;margin-bottom:4rem;}}.css-1mae7sn .gatsby-resp-image-wrapper .gatsby-resp-image-image{border-radius:4px;}.css-1mae7sn figure{margin:0;}.css-1mae7sn figure img{border-radius:4px;box-shadow:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);max-width:100%;}</style><section class="css-1mae7sn"><style data-emotion="css vehe2z">.css-vehe2z{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;}@media screen and (min-width: 640px){.css-vehe2z{font-size:1rem;}}@media screen and (min-width: 768px){.css-vehe2z{font-size:1.25rem;}}</style><style data-emotion="css z0logh">.css-z0logh{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;}@media screen and (min-width: 640px){.css-z0logh{font-size:1rem;}}@media screen and (min-width: 768px){.css-z0logh{font-size:1.25rem;}}@media screen and (min-width: 640px){.css-z0logh{font-size:1rem;}}@media screen and (min-width: 768px){.css-z0logh{font-size:1.25rem;}}</style><p class="css-z0logh">이 글은 <code class="css-zezy6m">만들면서 배우는 클린 아키텍처</code> 라는 책을 읽고 작성한 글이에요. 이 책에서는 전통적인 자바 + 스프링을 기반으로 아키텍처를 설명해나가요.</p>
<p class="css-z0logh">Spring + Java는 잘 발달한 DI 컨테이너를 제공해주며 클래스와 인터페이스 기반의 코드를 쉽게 작성할 수도 있어 책에서 설명하는 내용을 쉽게 적용할 수 있지만 Nodejs 는 런타임 타입 추론 능력이 자바보다 떨어질 뿐만 아니라, 각각의 라이브러리 별로 공통된 형태의 인터페이스가 없어 클린 아키텍처를 구현하는데 조금 더 어려움이 있을 것 같아 보였어요.</p>
<p class="css-z0logh">저는 이 책에서 <code class="css-zezy6m">변경을 용이하게 하는 방식</code> 에 가장 집중해봤어요.  또한 어떤 라이브러리를 사용해서 어떻게 구현을 해나가봤는지, 가장 중요하게 생각하는 부분이 어떤건지 실제 예제를 통해서 설명을 해보려고 해요.</p>
<p class="css-z0logh">이 아티클은 다음과 같은 순서로 설명을 해보려고 해요.</p>
<style data-emotion="css rc057y">.css-rc057y li{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width: 640px){.css-rc057y li{font-size:1rem;}}@media screen and (min-width: 768px){.css-rc057y li{font-size:1.25rem;}}</style><style data-emotion="css 15vy6y4">.css-15vy6y4 li{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width: 640px){.css-15vy6y4 li{font-size:1rem;}}@media screen and (min-width: 768px){.css-15vy6y4 li{font-size:1.25rem;}}.css-15vy6y4 li{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width: 640px){.css-15vy6y4 li{font-size:1rem;}}@media screen and (min-width: 768px){.css-15vy6y4 li{font-size:1.25rem;}}</style><ol class="css-15vy6y4">
<li class="css-zezy6m"><strong class="css-zezy6m">클린아키텍처란?</strong></li>
<li class="css-zezy6m"><strong class="css-zezy6m">기본 틀 작성</strong></li>
<li class="css-zezy6m"><strong class="css-zezy6m">유즈케이스와 도메인 작성</strong></li>
<li class="css-zezy6m"><strong class="css-zezy6m">트랜잭션 다루기</strong></li>
</ol>
<style data-emotion="css 90ntna">.css-90ntna{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-90ntna{font-size:1.875rem;}}@media screen and (min-width: 768px){.css-90ntna{font-size:1.875rem;}}@media screen and (min-width: 1024px){.css-90ntna{font-size:2.25rem;}}</style><style data-emotion="css 1h962gv">.css-1h962gv{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:2rem;color:var(--theme-ui-colors-heading);font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 768px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 1024px){.css-1h962gv{font-size:2.25rem;}}@media screen and (min-width: 640px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 768px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 1024px){.css-1h962gv{font-size:2.25rem;}}</style><h2 class="css-1h962gv">1. 클린아키텍처란?</h2>
<style data-emotion="css 1k2lv5x">.css-1k2lv5x{border-radius:4px;box-shadow:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);max-width:100%;}</style><style data-emotion="css elcu2x">.css-elcu2x{border-radius:4px;box-shadow:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);max-width:100%;border-radius:4px;box-shadow:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);max-width:100%;}</style><img src="https://velog.velcdn.com/images/jdd04026/post/ec938b30-6fe7-43c4-a07d-13ef5ea16777/image.png" alt="" class="css-elcu2x"/>
<p class="css-z0logh">제가 프로젝트를 구성하며 가장 중요하다고 생각했던 그림이에요. 엔티티는 그 어떤 의존성을 가지지 않고 있으며, 외부 기술로 빠져 나갈수록 더 많은 의존성을 가지게 되는 그림이에요.</p>
<p class="css-z0logh">로버트 C. 마틴은 클린 아키텍처에서는 설계가 비즈니스 규칙의 테스트를 용이하게 하고, 비즈니스 규칙은 프레임워크, 데이터베이스, UI 기술, 그 밖의 외부 애플리케이션이나 인터페이스로 부터 독립적일 수 있다고 이야기했어요.</p>
<p class="css-z0logh">-&gt; 이는 위 그림에서 도메인 코드가 바깥으로 향하는 어떠한 의존성도 없어야 하고, 의존성 역전을 활용하여 모든 의존성이 도메인을 향하도록 해야해요. 도메인은 다른 어떤 외부 의존성에 영향받지 않고, 독립적으로 구현되어있어야 하며, 데이터베이스나 UI 등 외부 기술들이 이 도메인을 활용하는 방향으로 구성이 되어있으면 된다고 이야기를 해요.</p>
<p class="css-z0logh">만약 ORM 을 사용한다고 가정을 해볼게요.</p>
<p class="css-z0logh">현 시점에서 가장 많이 사용하는 TypeORM 의 경우엔 TypeORM 에서 제공하는 Entity 클래스를 정의해서 이 클래스를 기준으로 데이터를 핸들링하고, Repository 를 이용해서 데이터를 DB 에 저장해요. 하지만 TypeORM 에서 직접 제공해주는 Repository 와 Entity 를 이용해서 도메인을 작성하게 되면 외부 의존성에 영향을 받고 독립적이지 못한 코드가 되어버려요. 따라서 도메인 계층과 데이터 영속 계층이 각각 다른 Entity 와 Repository 를 가지고, 데이터를 핸들링 할 수 있게 해야해요.</p>
<p class="css-z0logh">더 자세한 내용과 다양한 구현 방법은 책을 읽어보면 좋을 것 같아요!</p>
<h2 class="css-1h962gv">2. 기본 틀 작성</h2>
<style data-emotion="css 11bn2j6">.css-11bn2j6{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.25rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-11bn2j6{font-size:1.5rem;}}@media screen and (min-width: 768px){.css-11bn2j6{font-size:1.5rem;}}@media screen and (min-width: 1024px){.css-11bn2j6{font-size:1.875rem;}}</style><style data-emotion="css ns8t27">.css-ns8t27{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.25rem;margin-top:2rem;color:var(--theme-ui-colors-heading);font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.25rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-ns8t27{font-size:1.5rem;}}@media screen and (min-width: 768px){.css-ns8t27{font-size:1.5rem;}}@media screen and (min-width: 1024px){.css-ns8t27{font-size:1.875rem;}}@media screen and (min-width: 640px){.css-ns8t27{font-size:1.5rem;}}@media screen and (min-width: 768px){.css-ns8t27{font-size:1.5rem;}}@media screen and (min-width: 1024px){.css-ns8t27{font-size:1.875rem;}}</style><h3 class="css-ns8t27">설정한 제약사항</h3>
<p class="css-z0logh">위에서 간단하게 설명한 바로, 가장 중요하게 생각하는 두 가지 원칙을 설정하고 기본 틀을 구성해보려고 해요.</p>
<ol class="css-15vy6y4">
<li class="css-zezy6m">
<p class="css-z0logh"><code class="css-zezy6m">비즈니스 로직은 외부 의존성에 영향을 받으면 안된다</code> 라는 원칙은 반드시 지켜야해요.</p>
<p class="css-z0logh">위에서 언급한 클린아키텍처의 가장 중요한 부분이라고 생각해요.</p>
<img src="https://velog.velcdn.com/images/jdd04026/post/411b3760-3b2e-4274-a90c-a9f57d766373/image.png" alt="" class="css-elcu2x"/>
<p class="css-z0logh">이를 위해서 첫번째로 각각의 계층에서 사용할 엔티티를 나눠 정의하는 <code class="css-zezy6m">완전 맵핑 전략</code> 을 사용 해볼 예정이에요. 도메인 계층이 외부로 나갈때는 읽기 전용 모델로 변환해서 핸들링 하고, 도메인 계층을 수정해야 할 때는 커맨드 모델로 데이터를 핸들링 해요.</p>
<img src="https://velog.velcdn.com/images/jdd04026/post/ee96ea8a-0a20-4b43-80f1-7c947c66928a/image.png" alt="" class="css-elcu2x"/>
<p class="css-z0logh">두번째로 모든 계층을 오고 갈 땐 (Controller / View 부분 제외) 모두 인터페이스를 통해서 데이터를 핸들링 해요. 육각형 아키텍처에서 port 부분을 심플하게 가져가는 방향으로 바라봐도 좋아요. 이처럼 인터페이스로 각각의 계층을 묶어놓으면, 각각의 계층의 변경에 쉽게 대처할 수 있게돼요.</p>
</li>
<li class="css-zezy6m">
<p class="css-z0logh">Nodejs 에서 지원하는 기술은 도메인 계층에서도 사용할 수 있어요.</p>
<p class="css-z0logh">AsyncLocalStorage 등, 노드에서 직접 제공해주는 기능은 도메인에 침투해서 빠르게 비즈니스 로직을 작성할 수 있도록 편의를 위해 선택해봤어요. 프레임워크나 DB 데이터, 라이브 러리 등은 충분히 바뀔 수 있지만, 언어레벨에서 변경될 여지는 가장 낮아서 이런 제약정도는 괜찮을 것 같아요. (물론 file I/O 나 위에서 말한 AsyncLocalStorage 는 추후 로직 변경이나 더 나은 성능의 라이브러리 사용을 위해서라도 인터페이스로 묶어두면 좋아요)</p>
</li>
<li class="css-zezy6m">
<p class="css-z0logh">배포 환경이 변하더라도 빠르게 대응 가능해야해요.</p>
<p class="css-z0logh">Nodejs 는 스크립트 언어답게 Docker 환경, Lambda 등 다양한 환경에 배포할 수 있고, 서버 전략에 따라 많이 달라질 수 있어요. 이를 쉽게 대응할 수 있는 구조를 도입해보려고 했어요.</p>
</li>
</ol>
<h3 class="css-ns8t27">프로젝트 구조</h3>
<p class="css-z0logh">이 제약사항을 가지고 만들어낸 디렉터리 구성은 다음과 같아요. 최대한 계층별로 역할이 잘 드러나도록 디렉터리를 구성해봤어요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><style data-emotion="css ce1lkk">.css-ce1lkk{background-color:var(--theme-ui-colors-background);border:none;color:var(--theme-ui-colors-text);cursor:pointer;font-size:14px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";letter-spacing:0.025rem;-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;position:absolute;right:0;z-index:1;border-radius:0 0 0 0.25rem;padding:0.25rem 0.6rem;}@media screen and (min-width: 640px){.css-ce1lkk{font-size:14px;}}@media screen and (min-width: 768px){.css-ce1lkk{font-size:16px;}}.css-ce1lkk[disabled]{cursor:not-allowed;}.css-ce1lkk:not([disabled]):hover{background-color:var(--theme-ui-colors-primary);color:var(--theme-ui-colors-white);}</style><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<style data-emotion="css 15vf505">.css-15vf505{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">domain </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 도메인 계층을 넣어둬요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> application </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 비즈니스 로직을 넣어둬요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> configuration</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain">	</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> ticket</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">   	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> usecase </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// UseCase 는 서비스 계층을 접근하기 위한 인터페이스와 읽기 모델, 커맨드 모델을 넣어둬요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">       </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">TicketFinder</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">		</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">TicketCreateProcessor</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">       </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">TicketService</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// UseCase 를 구현한 서비스에요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> domain </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 가장 기본이 되는 도메인 엔티 티에요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">   </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> ticket</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">   	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">Ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">   	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">TicketRepository</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> data </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// DB, ES 등의 영속계층에 대한 Repository 를 직접 구현한 구현모델이 있는 곳이에요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> configuration</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain">	</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> ticket</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">		</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">TicketEntity</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">		</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">KnexTicketRepository</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">handler </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 서비스를 넣어둬요 (lambda 를 사용해보려고 handler 라는 이름을 사용했어요.)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> api</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> </span><span class="token maybe-class-name">TicketController</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> index</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> worker</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">	</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"> index</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ts</span></div></code></pre></div>
<ul class="css-15vy6y4">
<li class="css-zezy6m">
<p class="css-z0logh">각각 서버의 용도를 나누기 위해, handler 디렉터리에서는 api, worker 로 나눠서 관리해요. API 서버는 외부 요청을 받아들이는 Controller 를 담아둬요. Worker 서버는 API 서비스에서 이벤트로 발생한 비동기 요청을 처리하기 위해 존재하는 서버에요. 이 두 가지 서버에선 DI 컨테이너에 구성하는 싱글톤 클래스를 각각 다르게 담아, 필요한 기능만 사용 가능하도록 구성해봤어요.</p>
</li>
<li class="css-zezy6m">
<p class="css-z0logh">domain 디렉터리에는 비즈니스 로직을 포함한 실제 도메인과 관련된 로직을 위치시켰어요.</p>
<ul class="css-15vy6y4">
<li class="css-zezy6m">먼저 domain 디렉터리에는 가장 기본이 되는 엔티티와 그 엔티티를 저장하거나 찾기 위한 Repository 인터페이스를 위치시켜요.</li>
<li class="css-zezy6m">이 Repository 인터페이스는 data 디렉터리에서 필요한 외부 라이브러리를 사용하여 구성해요.</li>
<li class="css-zezy6m">마지막으로 application 디렉터리에는 엔티티를 사용해서 실제 비즈니스 로직을 작성하는 부분이에요. usecase 디렉터리에 외부 컨트롤러, 이벤트에서 호출할 때 사용할 인터페이스를 정의하고, 이를 Service 에서 구현하는 방식을 사용했어요.</li>
</ul>
</li>
</ul>
<p class="css-z0logh">도메인과 서버 서비스 계층을 완전히 분리한 이유는 만약 서버 구성을 다르게 가져가야 한다면, handler 디렉터리에 서버 구성 로직을 밀어넣어두고 도메인 계층에 영향이 아예 없도록 시도해보려고 구성을 했어요. 현재는 AWS lambda 사용을 기준으로 작성했지만 방어적인 구조로 인해, Docker 기반의 물리 인스턴스로도 빠르게 마이그레이션이 가능해요.</p>
<h3 class="css-ns8t27">라이브러리 선택</h3>
<p class="css-z0logh">위의 <code class="css-zezy6m">Interface - 구현체</code> 구조를 확장성 있게, 쉽게 완성하기 위해서는 DI 컨테이너의 도움이 필요해요. NodeJS 는 런타임에서 typescript 의 인터페이스를 찾을 수 없기에 의존성 주입이 어렵기 때문에 라이브러리의 도움을 받아야 해요. 이번 프로젝트에서는 <style data-emotion="css 1d2wwf6">.css-1d2wwf6{color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-1d2wwf6:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><style data-emotion="css 1diwg7s">.css-1diwg7s{color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-1diwg7s:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-1diwg7s:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="https://github.com/microsoft/tsyringe" class="css-1diwg7s">tsyringe</a> 을 사용했어요.</p>
<p class="css-z0logh">이 외의 라이브러리는 크게 중요하지 않고, 배포. DI 컨테이너 외의 기술은 아래와 같아요.</p>
<ul class="css-15vy6y4">
<li class="css-zezy6m">express -&gt; 다양한 기능을 제공하고, 여러 배포 방식을 다체롭게 지원해줘서 선택했어요.</li>
<li class="css-zezy6m">serverless framework</li>
<li class="css-zezy6m">knex / objection</li>
</ul>
<p class="css-z0logh">*여러 DI 컨테이너를 제공해주는 라이브러리들 중 자신이 익숙한 방식의 구현체를 가지고 있다면 큰 문제는 없어보여요.</p>
<h2 class="css-1h962gv">3. 유즈케이스와 도메인 작성</h2>
<h3 class="css-ns8t27">도메인 작성</h3>
<p class="css-z0logh">도메인은 영속계층에 영향 받지 않는, 하나의 도메인을 통채로 묶어야 해요. 영속 계층의 테이블에 영향을 받지 않아야 하며, 만약 테이블이 여러개라도 Repository 구현체에서 이를 핸들링 할 수 있기에 큰 문제는 없어요.</p>
<p class="css-z0logh">이번에는 <code class="css-zezy6m">Ticket</code> 이라는 도메인 모델을 Class 를 통해 정의했어요. Class 를 통해 정의하면, 도메인 수정이나 생성에 필요한 로직을 Class 내에 몰아서 관리할 수 있어요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">class</span><span class="token plain"> </span><span class="token class-name">Ticket</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    id</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">?</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword nil" style="color:var(--theme-ui-colors-keyword-color)">undefined</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">name</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">constructor</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token parameter literal-property property" style="color:var(--theme-ui-colors-property-color)">input</span><span class="token parameter operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token parameter"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token parameter">        id</span><span class="token parameter operator" style="color:var(--theme-ui-colors-operator-color)">?</span><span class="token parameter operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token parameter"> string</span><span class="token parameter punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token parameter"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token parameter">        </span><span class="token parameter literal-property property" style="color:var(--theme-ui-colors-property-color)">name</span><span class="token parameter operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token parameter"> string</span><span class="token parameter punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token parameter"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token parameter">    </span><span class="token parameter punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">??</span><span class="token plain"> </span><span class="token keyword nil" style="color:var(--theme-ui-colors-keyword-color)">undefined</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">name</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span></div></code></pre></div>
<p class="css-z0logh">위와 같이 티켓 도메인을 만들었어요. 이 도메인은 Repository 를 통해 save 와 select 가 가능해요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">interface</span><span class="token plain"> </span><span class="token class-name">TicketRepository</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">findById</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">id</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token maybe-class-name">Ticket</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain"> </span><span class="token keyword nil" style="color:var(--theme-ui-colors-keyword-color)">undefined</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">save</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">ticket</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token maybe-class-name">Ticket</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> </span><span class="token maybe-class-name">TicketRepository</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token string" style="color:var(--theme-ui-colors-string-color)">&quot;TicketRepository&quot;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// DI 를 위한 Symbol 이에요. 이 아티클에선 따로 다루지는 않을거에요.</span></div></code></pre></div>
<p class="css-z0logh">위와 같이 두가지 메소드를 가지고 있어요. 앞서 설명했듯, Ticket 도메인은 영속계층에서 사용되는 모델은 아니며, TicketRepository 의 구현체에서는 각각의 ORM 에서 필요로 하는 방식으로 도메인 모델을 변경해서 사용해요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// -- 영속 계층의 모델</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">class</span><span class="token plain"> </span><span class="token class-name">Tickets</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">extends</span><span class="token plain"> </span><span class="token class-name">Model</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Objection 의 모델</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    id</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">!</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    name</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">!</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">--</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">-</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// -- Repository 의 구현체</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">@</span><span class="token function" style="color:var(--theme-ui-colors-function-color)">injectable</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">class</span><span class="token plain"> </span><span class="token class-name">KnexTicketRepository</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">implements</span><span class="token plain"> </span><span class="token class-name">TicketRepository</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token spread operator" style="color:var(--theme-ui-colors-operator-color)">...</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">save</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">ticket</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token maybe-class-name">Ticket</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">object</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Partial</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token maybe-class-name">Tickets</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Objection 모델로 변환</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">            </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">id</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">            </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">name</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> result </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token maybe-class-name">Tickets</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">query</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">upsertGraphAndFetch</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">object</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">toTicket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 변환되어 저장된 결과를 다시 도메인 모델로 변환</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span></div></code></pre></div>
<p class="css-z0logh">마지막으로 Application 부분이에요. 각각의 기능별로 Finder[R], Processor[CUD] 로 나눠봤어요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">interface</span><span class="token plain"> </span><span class="token class-name">TicketCreateProcessor</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">process</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">command</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token maybe-class-name">TicketCreateCommand</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token plain">string</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> type </span><span class="token maybe-class-name">TicketCreateCommand</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">name</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">count</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">requesterId</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span></div></code></pre></div>
<p class="css-z0logh">위와 같이 커멘드를 통해 필요한 정보를 외부에서 직접 주입해서 사용할 수 있도록 제한했어요. 만약 유효성 검증이 필요하다면 Class 로 선언해서 내부 메소드로서 검증을 위한 로직을 밀어넣어도 좋다고 생각돼요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// TicketCreateProcessor 의 구현체</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">process</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">command</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token maybe-class-name">TicketCreateCommand</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token plain">string</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> ticketId </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">transactionManager</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">init</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> ticket </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ticketRepository</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">save</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">            </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">new</span><span class="token plain"> </span><span class="token class-name">Ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">                </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">name</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> command</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">                </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">count</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> command</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">count</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">                </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">createdBy</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> command</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">requesterId</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">            </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">requireId</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span></div></code></pre></div>
<p class="css-z0logh">위의 로직에서 볼 수 있듯, 외부 Command 를 내부 엔티티 모델인 Ticket 으로 변환해서 사용을 하고, DI 컨테이너에서 주입받은 레포지토리를 사용하여 도메인 엔티티를 저장해요. 필요하다면 다른 엔티티를 들고와서 비즈니스 로직을 완성할 수 있어요.</p>
<p class="css-z0logh">컨트롤러나 그 외 다른 외부 콜에서는 Processor 나 Finder 를 통해 읽기 모델을 리턴받아서 사용하고, Repository 를 직접적으로 바라봐서 로직이 파편화되는 문제를 해결할 수 있어요.</p>
<h2 class="css-1h962gv">4. 트랜잭션 다루기</h2>
<p class="css-z0logh">Spring 의 경우 @Transactional 어노테이션을 제공해주지만 (책에서도 굉장히 짧게 다뤄서 가장 애를 먹었던 곳이에요), Nodejs 진영에선 통합된 영속 계층 규약이 없기에 이런 통합적인 규약이 없지만, ORM 에서 공통적으로 보이는 특징은 아래와 같아요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// TypeORM</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> myDataSource</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">transaction</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token parameter">transactionalEntityManager</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// execute queries using transactionalEntityManager</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Objection</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> returnValue </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token maybe-class-name">Person</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">transaction</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token parameter">trx</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">  </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Here you can use the transaction.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">  </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Whatever you return from the transaction callback gets returned</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">  </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// from the `transaction` function.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> </span><span class="token string" style="color:var(--theme-ui-colors-string-color)">&#x27;the return value of the transaction&#x27;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Sequelize</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> result </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> sequelize</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">transaction</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token parameter">t</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">  </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> user </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">create</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">firstName</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token string" style="color:var(--theme-ui-colors-string-color)">&#x27;Abraham&#x27;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">lastName</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token string" style="color:var(--theme-ui-colors-string-color)">&#x27;Lincoln&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">  </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">transaction</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> t </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> user</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span></div></code></pre></div>
<p class="css-z0logh">위의 코드들과 같이, connection / 전역 변수를 통해 Transaction 을 실행시키고, 내부 콜백에서 영속 계층을 다루기 위한 코드를 넣어서 핸들링해요.</p>
<p class="css-z0logh">위의 코드를 살펴보면 Application 계층에서 Repository 를 호출하는 형태가 가장 일반적이에요. 또한 비즈니스 로직에서만이 특정 데이터들을 Atomic 하게 다룰지 판단할 수 있어요. 따라서 비즈니스 로직에서 아래와 같은 형태가 보이면 트랜잭션을 컨트롤 할 수 있을거에요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Application 계층 구현체</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">findById</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">id</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token maybe-class-name">TicketDetail</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> ticket </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">transactionManager</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">init</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 이곳에서 트랜잭션을 열어요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> ticket </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">ticketRepository</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">findById</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Repository 호출</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">ticket </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">===</span><span class="token plain"> </span><span class="token keyword nil" style="color:var(--theme-ui-colors-keyword-color)">undefined</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">new</span><span class="token plain"> </span><span class="token class-name">TicketNotFoundError</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> ticket</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">new</span><span class="token plain"> </span><span class="token class-name">TicketDetail</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">ticket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// Repository 계층 구현체</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">findById</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">id</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token maybe-class-name">Ticket</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain"> </span><span class="token keyword nil" style="color:var(--theme-ui-colors-keyword-color)">undefined</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> trx </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">transactionManager</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">getTransaction</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 현재 열려있는 트랜잭션 객체 가져오기.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">const</span><span class="token plain"> result </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token maybe-class-name">Tickets</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">query</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">trx</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">select</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token string" style="color:var(--theme-ui-colors-string-color)">&#x27;*&#x27;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">where</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token string" style="color:var(--theme-ui-colors-string-color)">&#x27;id&#x27;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">first</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">result </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">===</span><span class="token plain"> </span><span class="token keyword nil" style="color:var(--theme-ui-colors-keyword-color)">undefined</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> result</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> result</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">?.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">toTicket</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span></div></code></pre></div>
<p class="css-z0logh">Repository 는 비즈니스 로직 내에서 호출되기에, 트랜잭션을 직접 열 수 있는 <code class="css-zezy6m">initTransaction</code> 을 사용해서 트랜잭션 객체를 생성해요. 콜백 내에서는 <code class="css-zezy6m">getTransaction</code> 을 통해 현재 열려있는 트랜잭션 객체를 가져올 수 있어요. (라이브러리에 따라 현재 트랜잭션 객체가 없더라도 동작하게 할 수 있을거에요. 제가 사용한 Objection 은 트랜잭션 객체가 없더라도 전역 커넥션을 꺼내와서 동작해요.)</p>
<p class="css-z0logh">이런 코드는 <code class="css-zezy6m">AsyncLocalStoage</code> 를 사용하면 쉽게 구현할 수 있어요.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" data-linenumber="false"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-javascript"><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token keyword module" style="color:var(--theme-ui-colors-keyword-color)">export</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">class</span><span class="token plain"> </span><span class="token class-name">KnexTransactionManager</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">implements</span><span class="token plain"> </span><span class="token class-name">TransactionManager</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">private</span><span class="token plain"> </span><span class="token literal-property property" style="color:var(--theme-ui-colors-property-color)">asyncLocalStorage</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncLocalStorage</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token maybe-class-name">Knex</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access maybe-class-name">Transaction</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">constructor</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">asyncLocalStorage</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">=</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">new</span><span class="token plain"> </span><span class="token class-name">AsyncLocalStorage</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">;</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">	</span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// 트랜잭션을 열기 위한 메소드, 콜백을 받아서 트랜잭션 객체를 넣어줘요.</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> init</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token constant" style="color:var(--theme-ui-colors-constant-color)">T</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token function-variable function" style="color:var(--theme-ui-colors-function-color)">callback</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token parameter literal-property property" style="color:var(--theme-ui-colors-property-color)">trx</span><span class="token parameter operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Knex</span><span class="token parameter punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token parameter property-access maybe-class-name">Transaction</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token constant" style="color:var(--theme-ui-colors-constant-color)">T</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&lt;</span><span class="token constant" style="color:var(--theme-ui-colors-constant-color)">T</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> connection</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">transaction</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token parameter">trx</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">asyncLocalStorage</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">run</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">trx</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">,</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:var(--theme-ui-colors-operator-color)">=&gt;</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">await</span><span class="token plain"> </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">callback</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token plain">trx</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token comment" style="color:var(--theme-ui-colors-comment-color);font-style:var(--theme-ui-colors-comment-fontStyle)">// init 메소드 내에서 실행된 </span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token function" style="color:var(--theme-ui-colors-function-color)">getTransaction</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Knex</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access maybe-class-name">Transaction</span><span class="token plain"> </span><span class="token operator" style="color:var(--theme-ui-colors-operator-color)">|</span><span class="token plain"> </span><span class="token keyword nil" style="color:var(--theme-ui-colors-keyword-color)">undefined</span><span class="token plain"> </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">{</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:var(--theme-ui-colors-keyword-color)">return</span><span class="token plain"> </span><span class="token keyword" style="color:var(--theme-ui-colors-keyword-color)">this</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token property-access">asyncLocalStorage</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">.</span><span class="token method function property-access" style="color:var(--theme-ui-colors-function-color)">getStore</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">(</span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">)</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain">    </span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span><span class="token plain"></span></div><div class="token-line" style="color:var(--theme-ui-colors-plain-color)"><span class="token plain"></span><span class="token punctuation" style="color:var(--theme-ui-colors-punctuation-color)">}</span></div></code></pre></div>
<p class="css-z0logh"><code class="css-zezy6m">AsyncLocalStorage</code> 는 Node.js 16 부터 stable 이 된 기능이에요. 마치 ThreadLocal 처럼 호출한 하나의 비동기 로직 내에서 마치 내부 스토리지를 사용할 수 있도록 도와주는 기능이에요. 이를 통해, 상위 계층에서 호출한 트랜잭션을 하위 메소드에서도 쉽게 가져다 쓸 수 있는 방식이 완성되었어요. 이 또한 외부 라이브러리로 의존성이 변경될 수 있기에, 공통기능을 묶어서 인터페이스로 제공할 수 있도록 했어요.</p>
<h2 class="css-1h962gv">참고</h2>
<p class="css-z0logh">이번 글을 쓰면서 만든 <a href="https://github.com/FullOfOrange/node-clean-architecture" class="css-1diwg7s">원본 프로젝트 레포</a> 에요. 설명이 안된 여러 개념들이 녹아들어 있지만 천천히 아티클을 고쳐나가보려고 해요.</p></section></main><style data-emotion="css y7pay1">.css-y7pay1{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-top:8rem;color:var(--theme-ui-colors-secondary);-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border-top-style:solid;border-top-width:1px;border-top-color:var(--theme-ui-colors-divide);padding-top:1rem;}.css-y7pay1 a{color:var(--theme-ui-colors-secondary);-webkit-text-decoration:none;text-decoration:none;}.css-y7pay1 a:hover{color:var(--theme-ui-colors-heading);-webkit-text-decoration:underline;text-decoration:underline;}.css-y7pay1 a:focus{color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-y7pay1{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media screen and (min-width: 768px){.css-y7pay1{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><footer class="css-y7pay1"><div>© <!-- -->2023<!-- --> by <!-- -->육진혁 블로그<!-- -->. All rights reserved.</div><div><a aria-label="Link to the theme&#x27;s GitHub repository" href="https://github.com/LekoArts/gatsby-themes/tree/main/themes/gatsby-theme-minimal-blog" class="css-aizfxq">Theme</a> <!-- -->by<!-- --> <a aria-label="Link to the theme author&#x27;s website" href="https://www.lekoarts.de?utm_source=minimal-blog&amp;utm_medium=Theme" class="css-aizfxq">LekoArts</a></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/node-js-clean-architecture/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-c9821d4344131c51bd6e.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx-411f1f496e2621f9b26d.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-homepage-query-tsx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-homepage-query-tsx-039f300c247be1f1ba13.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx-content-file-path-content-pages-about-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx-content-file-path-content-pages-about-index-mdx-b742c2318f6a37b17605.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-nodejs-clean-architecture-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-nodejs-clean-architecture-index-mdx-51a9aa0f9043487c019a.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx-42a5e574771d676e7e52.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-fedef0cd57de257ebeca.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="80e021a3e949e3901e78";</script><script src="/webpack-runtime-e1bac94fd76cee0aba3f.js" async></script><script src="/framework-f689a2a97f4fb6f27065.js" async></script><script src="/app-c9821d4344131c51bd6e.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>